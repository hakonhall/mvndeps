package no.ion.mvndeps.build;

import org.junit.jupiter.api.Test;

import java.nio.file.Path;

import static org.junit.jupiter.api.Assertions.assertTrue;

class BuildTest {
    private final Path vespaPath = Path.of("/home/hakon/local/github/vespa-engine/vespa");

    @Test
    void readTimings() {
        BuildMain.main("dot", "-i", "/home/hakon/tmp/build-timings", "-o", "/home/hakon/tmp/build.dot");
    }

    //@Test
    void buildAll() {
        BuildMain.main("timings", "-o", "/home/hakon/tmp/build-timings");
    }

    @Test
    void test() {
        String dot = Build.read(vespaPath).toDot("build");
        assertTrue(dot.startsWith("""
                             digraph build {
                               "com.yahoo.vespa:vespa"
                               "com.yahoo.vespa:container-dependency-versions"
                               "com.yahoo.vespa:container-dependency-versions" -> "com.yahoo.vespa:parent"
                               "com.yahoo.vespa:parent"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:application-model"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:defaults"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:jdisc_jetty"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:jaxrs_utils"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespa-feed-client"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespa-feed-client-cli"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:socket_test"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa.jdisc_core:integration-test-parent"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa.bundle-plugin:bundle-plugin-test"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:yolean"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:orchestrator-restapi"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespa_jersey2"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:config-lib"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:configdefinitions"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vsm"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:searchsummary"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:searchcore"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:testutil"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:storage"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:metrics"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:client"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:logd"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:security-utils"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespajlib"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:jdisc_core"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:provided-dependencies"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:hosted-zone-api"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:fsa"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-apache-http-client-bundle"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:tenant-cd-api"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:zookeeper-client-common"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:zookeeper-command-line-client"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:clustercontroller-utils"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:predicate-search-core"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:jaxrs_client_utils"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespalog"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:predicate-search"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:security-tools"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:jrt"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:logserver"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:config"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:fileacquirer"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:filedistribution"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:config-proxy"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:config-bundle"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:component"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:config-provisioning"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:config-model-api"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:config-application-package"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:linguistics"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:linguistics-components"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:hosted-api"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespa-maven-plugin"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:statistics"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:tenant-cd-commons"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:flags"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespa-http-client"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespa-hadoop"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:document"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vdslib"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:searchlib"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:model-integration"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:indexinglanguage"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:messagebus"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:documentapi-dependencies"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:documentapi"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-documentapi"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespa_feed_perf"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-messagebus"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-core"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:metrics-proxy"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:docproc"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-disc"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-search"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-search-and-docproc"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-search-gui"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:model-evaluation"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-dev"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespa-athenz"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:jdisc-security-filters"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:service-monitor"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespa-osgi-testrunner"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:configserver-client"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:docprocs"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:serviceview"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:controller-api"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespaclient-core"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:config-model"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:fat-model-dependencies"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:application-preprocessor"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespaclient-java"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespa-documentgen-plugin"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:documentgen-test"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:config-model-fat"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:jdisc-cloud-aws"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:zookeeper-server"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:zkfacade"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:configserver-flags"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:standalone-container"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:application"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-integration-test"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-test"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:vespaclient-container-plugin"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:controller-server"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:orchestrator"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:node-repository"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:node-admin"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:athenz-identity-provider-service"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:clustercontroller-reindexer"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:container-dependencies-enforcer"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa.hosted:vespa-testrunner-components"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:clustercontroller-core"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:clustercontroller-apps"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:cloud-tenant-cd"
                               "com.yahoo.vespa:parent" -> "com.yahoo.vespa:configserver"
                               "com.yahoo.vespa:configserver"
                               "com.yahoo.vespa:cloud-tenant-cd"
                               "com.yahoo.vespa:cloud-tenant-cd" -> "com.yahoo.vespa:cloud-tenant-base"
                               "com.yahoo.vespa:cloud-tenant-cd" -> "com.yahoo.vespa:tenant-base"
                               "com.yahoo.vespa:tenant-base"
                               "com.yahoo.vespa:cloud-tenant-base"
                               "com.yahoo.vespa:cloud-tenant-base" -> "com.yahoo.vespa:cloud-tenant-base-dependencies-enforcer"
                               "com.yahoo.vespa:cloud-tenant-base-dependencies-enforcer"
                               "com.yahoo.vespa:clustercontroller-apps"
                               "com.yahoo.vespa:clustercontroller-core"
                               "com.yahoo.vespa:clustercontroller-core" -> "com.yahoo.vespa:clustercontroller-apps"
                               "com.yahoo.vespa.hosted:vespa-testrunner-components"
                               "com.yahoo.vespa:container-dependencies-enforcer"
                               "com.yahoo.vespa:container"
                               "com.yahoo.vespa:container" -> "com.yahoo.vespa:container-dependencies-enforcer"
                               "com.yahoo.vespa:container" -> "com.yahoo.vespa:hosted-tenant-base"
                               "com.yahoo.vespa:container" -> "com.yahoo.vespa.hosted:vespa-testrunner-components"
                               "com.yahoo.vespa:container" -> "com.yahoo.vespa:tenant-base"
                               "com.yahoo.vespa:hosted-tenant-base"
                               "com.yahoo.vespa:hosted-tenant-base" -> "com.yahoo.vespa:cloud-tenant-base"
                               "com.yahoo.vespa:clustercontroller-reindexer"
                               "com.yahoo.vespa:athenz-identity-provider-service"
                               "com.yahoo.vespa:node-admin"
                               "com.yahoo.vespa:node-repository"
                               "com.yahoo.vespa:node-repository" -> "com.yahoo.vespa:node-admin"
                               "com.yahoo.vespa:node-repository" -> "com.yahoo.vespa:athenz-identity-provider-service"
                               "com.yahoo.vespa:orchestrator"
                               "com.yahoo.vespa:orchestrator" -> "com.yahoo.vespa:node-repository"
                               "com.yahoo.vespa:orchestrator" -> "com.yahoo.vespa:node-admin"
                               "com.yahoo.vespa:orchestrator" -> "com.yahoo.vespa:configserver"
                               "com.yahoo.vespa:controller-server"
                               "com.yahoo.vespa:vespaclient-container-plugin"
                               "com.yahoo.vespa:vespaclient-container-plugin" -> "com.yahoo.vespa:container"
                               "com.yahoo.vespa:container-test"
                               "com.yahoo.vespa:container-test" -> "com.yahoo.vespa:vespaclient-container-plugin"
                               "com.yahoo.vespa:container-test" -> "com.yahoo.vespa:controller-server"
                               "com.yahoo.vespa:container-test" -> "com.yahoo.vespa:node-repository"
                               "com.yahoo.vespa:container-test" -> "com.yahoo.vespa:node-admin"
                               "com.yahoo.vespa:container-test" -> "com.yahoo.vespa:athenz-identity-provider-service"
                               "com.yahoo.vespa:container-test" -> "com.yahoo.vespa:clustercontroller-reindexer"
                               "com.yahoo.vespa:container-test" -> "com.yahoo.vespa:container-dependencies-enforcer"
                               "com.yahoo.vespa:container-test" -> "com.yahoo.vespa:hosted-tenant-base"
                               "com.yahoo.vespa:container-test" -> "com.yahoo.vespa:tenant-base"
                               "com.yahoo.vespa:container-test" -> "com.yahoo.vespa:configserver"
                               "com.yahoo.vespa:container-integration-test"
                               "com.yahoo.vespa:application"
                               "com.yahoo.vespa:application" -> "com.yahoo.vespa:container-integration-test"
                               "com.yahoo.vespa:application" -> "com.yahoo.vespa:container-test"
                               "com.yahoo.vespa:application" -> "com.yahoo.vespa:vespaclient-container-plugin"
                               "com.yahoo.vespa:application" -> "com.yahoo.vespa:controller-server"
                               "com.yahoo.vespa:application" -> "com.yahoo.vespa:orchestrator"
                               "com.yahoo.vespa:application" -> "com.yahoo.vespa:node-repository"
                               "com.yahoo.vespa:application" -> "com.yahoo.vespa:node-admin"
                               "com.yahoo.vespa:application" -> "com.yahoo.vespa:athenz-identity-provider-service"
                               "com.yahoo.vespa:standalone-container"
                               "com.yahoo.vespa:standalone-container" -> "com.yahoo.vespa:application"
                               "com.yahoo.vespa:configserver-flags"
                               "com.yahoo.vespa:configserver-flags" -> "com.yahoo.vespa:controller-server"
                               "com.yahoo.vespa:configserver-flags" -> "com.yahoo.vespa:configserver"
                               """));
    }

}